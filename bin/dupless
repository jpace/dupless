#!/usr/bin/env ruby

dir = File.dirname(File.dirname(File.expand_path(__FILE__)))
libpath = dir + "/lib"
$:.unshift libpath

require 'dupless/file'
require 'dupless/fdprocessor'
require 'dupless/set'
require 'dupless/entry'
require 'pathname'
require 'logue'

Logue::Log::level = Logue::Level::DEBUG

module Dupless
  class App < FileDirProcessor
    include Logue::Loggable
    
    def initialize args
      @all = Set.new
      super args
    end

    def process_file file 
      df = Dupless::File.new file
      @all << df
    end

    def show_duplicates
      info "self: #{self}"
      dups = @all.duplicates_2
      puts "#dups: #{dups.size}"
      # puts "dups: #{dups}"
      dups.each do |dup|
        puts "dup: #{dup}"
      end
    end
  end
end

app = Dupless::App.new ARGV
app.show_duplicates
